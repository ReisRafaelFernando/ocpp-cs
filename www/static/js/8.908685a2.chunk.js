(this["webpackJsonpocpp-cs"]=this["webpackJsonpocpp-cs"]||[]).push([[8],{824:function(e,t,n){"use strict";var a=n(9),r=n(26),i=n(19),c=n(18),s=n(27),o=n(28),d=n(794),l=n(459),p=n(822),u=n(313),h=n(854),m=n(205),g=n(0),b=n.n(g),j=n(109),f=n(153),v=n(460),x=n(2),O=d.a.confirm,y=function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(e){var c;return Object(i.a)(this,n),(c=t.call(this,e)).popoverToggle=function(){c.setState((function(e){return{popoverOpen:!e.popoverOpen,methods:e.popoverOpen?e.methods:[]}}),(function(){return c.load()}))},c.pendingStart=function(){c.props.onPendingStart?c.props.onPendingStart():c.setState({pending:!0})},c.pendingEnd=function(){c.props.onPendingEnd?c.props.onPendingEnd():c.setState({pending:!1})},c.load=Object(r.a)(Object(a.a)().mark((function e(){var t;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.state.popoverOpen){e.next=6;break}return c.pendingStart(),e.next=4,c.context.api.q("/".concat(c.props.classcode,"/method"),{id:c.props.id},{toArray:!0});case 4:t=e.sent,c.setState({methods:t},(function(){return c.pendingEnd()}));case 6:case"end":return e.stop()}}),e)}))),c.run=function(){var e=Object(r.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.pendingStart(),e.next=3,c.context.api.q("/method/run",{id:c.props.id,method:t.id});case 3:n=e.sent,c.pendingEnd(),c.popoverToggle(),n?(l.b.success(c.m("method.success")),c.props.onFinish&&c.props.onFinish(t)):(l.b.error(c.m("method.fail")),c.setState({pending:!1}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.ask=function(){var e=Object(r.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"drop"===t.actioncode?O({title:c.m("method.confirm.title"),content:c.m("method.confirm.text"),icon:Object(x.jsx)(f.a,{}),onOk:function(){c.run(t)}}):c.run(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.m=function(e){return c.props.intl.formatMessage({id:e})},c.state={popoverOpen:!1,methods:[]},c}return Object(c.a)(n,[{key:"render",value:function(){var e,t=this;if(null===(e=this.props)||void 0===e||!e.statelabel)return null;var n=this.state,a=n.pending,r=n.methods,i=void 0===r?[]:r,c=Object(x.jsx)(p.a,{className:"gx-m-0",color:{created:"processing",enabled:"success",disabled:"default",deleted:"error"}[this.props.statetypecode],children:this.props.statelabel});return this.props.readOnly?c:Object(x.jsx)(u.a,{content:Object(x.jsx)("div",{className:"".concat(0===i.length&&"gx-p-3"),children:Object(x.jsx)(h.a,{spinning:a,children:i.map((function(e){return e.visible?Object(x.jsx)("div",{onClick:function(){return t.ask(e)},className:"gx-my-2 gx-pointer gx-link",children:e.label},e.id):null}))})}),trigger:"click",visible:this.state.popoverOpen,onVisibleChange:this.popoverToggle,children:Object(x.jsx)("div",{className:"gx-pointer",children:c})})}}]),n}(b.a.Component);y.contextType=j.a;t.a=Object(v.b)(Object(m.c)(y),{statelabel:function(e){return e.statenewlabel},statetypecode:function(e){return e.statenewtypecode}})},827:function(e,t,n){"use strict";var a=n(9),r=n(26),i=n(19),c=n(18),s=n(27),o=n(28),d=n(0),l=n.n(d),p=n(205),u=n(864),h=n(109),m=n(2),g=u.a.Option,b=function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(e){var c;return Object(i.a)(this,n),(c=t.call(this,e)).createSearch=function(){var e=c.props.search||[];return c.state.searchText&&c.props.async&&e.push({field:c.props.labelKey||"label",compare:"IKE",value:"%".concat(c.state.searchText,"%")}),c.props.enabledOnly&&e.push({field:"statetypecode",compare:"EQL",value:"enabled"}),e},c.getLabelKey=function(){return c.props.labelKey||"label"},c.getIdKey=function(){return c.props.valueKey||"id"},c.shureHaveValue=Object(r.a)(Object(a.a)().mark((function e(){var t;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.props.async){e.next=8;break}if(c.state.items.find((function(e){return e[c.getIdKey()]===c.props.value}))){e.next=8;break}return c.setState({pending:!0}),e.next=5,c.context.api.q("/object/get",{id:c.props.value,fields:[c.getIdKey(),c.getLabelKey()]});case 5:t=e.sent,c.setState({pending:!1}),null!==t&&void 0!==t&&t[c.getLabelKey()]&&c.setState((function(e){var n=e.items;return n.push(t),{items:n}}));case 8:case"end":return e.stop()}}),e)}))),c.load=Object(r.a)(Object(a.a)().mark((function e(){var t,n,r,i,s;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.props.items){e.next=3;break}return c.setState({items:c.props.items}),e.abrupt("return");case 3:if(t=[],n=c.props.async?1:0,!c.props.query){e.next=14;break}return c.setState({pending:!0}),r=c.createSearch(),i=[c.getIdKey(),c.getLabelKey()].concat(c.props.extraFields||[]),s=c.props.cache?c.context.api.cache:c.context.api.q,e.next=12,s(c.props.query,{search:r,reclimit:n,fields:i},{toArray:!0});case 12:t=e.sent,c.setState({pending:!1,items:t});case 14:case"end":return e.stop()}}),e)}))),c.onSearch=function(){var e=Object(r.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.props.async&&c.setState({searchText:t},(function(){return c.load()}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.onChange=function(e){var t=c.state.items.find((function(t){return t[c.getIdKey()]===e}));c.props.onChange(e,t)},c.state={searchText:"",pending:!1,items:[]},c}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.load().then(this.shureHaveValue())}},{key:"componentDidUpdate",value:function(e){e.value!==this.props.value&&this.shureHaveValue()}},{key:"render",value:function(){var e=this,t=this.state.items.map((function(t,n){var a=t||{},r=a[e.getIdKey()],i=e.props.formatLabel?e.props.formatLabel(t):a[e.getLabelKey()];return r===e.props.value&&!0,Object(m.jsx)(g,{value:r,children:i},n)}));return Object(m.jsx)(u.a,{defaultActiveFirstOption:!1,allowClear:this.props.allowClear,loading:!!this.state.pending,value:this.state.pending?null:this.props.value,showSearch:!0,placeholder:this.props.placeholder,optionFilterProp:"children",onChange:this.onChange,onSearch:this.onSearch,filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0},children:t})}}]),n}(l.a.Component);b.contextType=h.a,t.a=Object(p.c)(b)},829:function(e,t,n){"use strict";function a(e,t){var n=e.match.params||{},a=t.match.params||{};return n.param1!==a.param1||n.param2!==a.param2||n.param3!==a.param3}n.d(t,"a",(function(){return a}))},855:function(e,t,n){"use strict";var a=n(19),r=n(18),i=n(27),c=n(28),s=n(0),o=n.n(s),d=n(861),l=n(854),p=n(205),u=n(850),h=n(2),m=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"stations.map.",n=r.props.intl;return n.formatMessage({id:t+e})},r.getItemGeo=function(e){var t,n=(null===e||void 0===e||null===(t=e.geo)||void 0===t?void 0:t[0])||{},a=n.latitude,r=n.longitude;return a&&r?[a,r]:null},r.config=window.appConfig||{mapLanguage:"ru_RU"},r.state={mapLoaded:!1},r}return Object(r.a)(n,[{key:"render",value:function(){var e=this,t=this.props.stations;if(!Array.isArray(t))return null;if(0===t.length)return Object(h.jsx)(d.a,{});var n=o.a.createRef(),a=t.map((function(t){return e.getItemGeo(t)})).filter((function(e){return e}));if(0===a.length)return Object(h.jsx)("div",{className:this.props.className,children:Object(h.jsx)(d.a,{})});var r=this.config.mapLanguage;return Object(h.jsxs)("div",{className:this.props.className,children:[!this.state.mapLoaded&&Object(h.jsx)(l.a,{spinning:!0}),Object(h.jsx)(u.c,{query:{lang:r},children:Object(h.jsxs)(u.a,{defaultState:{center:a[0]||[],zoom:9},width:"100%",height:"100%",modules:["geoObject.addon.balloon","util.bounds"],onLoad:function(t){e.setState({mapLoaded:!0}),a.length>1&&n.current.setBounds(t.util.bounds.fromPoints(a))},instanceRef:function(e){e&&(n.current=e)},children:[t.map((function(t,n){var a=e.getItemGeo(t);if(!a)return null;var r=[];return t.description&&r.push("<div>".concat(t.description||"","</div>")),t.modelname&&r.push("<div>".concat(t.modelname||""," ").concat(t.vendorname||"","</div>")),Object(h.jsx)(u.b,{defaultGeometry:a,options:{iconLayout:"default#image",iconImageHref:"/assets/images/images-32-removebg-preview.png",iconImageSize:[32,32]},properties:{balloonContentHeader:"".concat(t.label),balloonContent:r.join(""),balloonContentFooter:'<a href="/crm/station/'.concat(t.id,'">').concat(e.m("more"),"</a>")}},n)})),Object(h.jsx)(u.d,{})]})},r)]})}}]),n}(o.a.Component);t.a=Object(p.c)(m)},865:function(e,t,n){"use strict";function a(e){return!!e&&("Invalid Date"!==new Date(e)&&!isNaN(new Date(e)))}n.d(t,"a",(function(){return a}))},866:function(e,t,n){"use strict";var a=n(808),r=n(895),i=n(158),c=n(143),s=n(0),o=n.n(s),d=n(460),l=n(2);t.a=Object(d.b)((function(e){var t=["preparing","charging","finishing"].includes(e.statecode),n=["reserved"].includes(e.statecode);return Object(l.jsxs)(o.a.Fragment,{children:[Object(l.jsx)(i.a,{title:e.m("btn.charge"),children:Object(l.jsx)(c.a,{className:"gx-mr-1",onClick:function(n){n.stopPropagation(),e.chargeToggle(t)},icon:Object(l.jsx)(a.a,{className:"".concat(t?"gx-text-warning":"")})})}),Object(l.jsx)(i.a,{title:e.m("btn.reserve"),children:Object(l.jsx)(c.a,{onClick:function(t){t.stopPropagation(),e.reserveToggle(n)},icon:Object(l.jsx)(r.a,{className:"".concat(n?"gx-text-warning":"")})})})]})}),{statecode:function(e){return e.statenewcode}})},915:function(e,t,n){"use strict";n.r(t);var a=n(9),r=n(26),i=n(19),c=n(18),s=n(27),o=n(28),d=n(861),l=n(795),p=n(859),u=n(0),h=n.n(u),m=n(111),g=n(205),b=n(53),j=n(850),f=n(96),v=n(109),x=n(174),O=n(829),y=n(827),w=n(3),S=n(7),k=n(32),I=n(459),C=n(842),P=n(843),N=n(854),L=n(143),T=n(865),q=n(212),K=n(824),E=n(866),D=n(460),F=n(2);D.a.tick();var A=function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(e){var c;return Object(i.a)(this,n),(c=t.call(this,e)).m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"stations.",n=c.props.intl;return n.formatMessage({id:t+e})},c.pendingStart=function(){c.props.onPendingStart?c.props.onPendingStart():c.setState({pending:!0})},c.pendingEnd=function(){c.props.onPendingEnd?c.props.onPendingEnd():c.setState({pending:!1})},c.load=Object(r.a)(Object(a.a)().mark((function e(){var t,n,r,i,s,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.props.stationId){e.next=13;break}return c.pendingStart(),t=[c.context.api.q("/charge_point/get",{id:c.props.stationId}),c.context.api.q("/object/access/decode",{id:c.props.stationId}),c.context.api.q("/object/file",{id:c.props.stationId},{toArray:!0})],e.next=5,Promise.allSettled(t);case 5:n=e.sent.map((function(e){return e.value})),r=Object(S.a)(n,3),i=r[0],s=r[1],o=r[2],c.setState({item:i,access:s,files:o},(function(){return c.pendingEnd()})),e.next=14;break;case 13:c.setState({item:{},access:{},files:[]});case 14:case"end":return e.stop()}}),e)}))),c.chargeToggle=Object(r.a)(Object(a.a)().mark((function e(){var t,n,r=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=r.length>0&&void 0!==r[0]?r[0]:{}).id){e.next=16;break}if(c.setState({detailPending:!0}),n=!1,!t.charging){e.next=10;break}return e.next=7,c.context.api.q("/connector/remote/stop",{id:t.id});case 7:n=e.sent,e.next=13;break;case 10:return e.next=12,c.context.api.q("/connector/remote/start",{id:t.id});case 12:n=e.sent;case 13:c.setState({detailPending:!1}),!1===n?I.b.error(c.m("method.fail","")):I.b.success(c.m("method.success","")),c.load();case 16:case"end":return e.stop()}}),e)}))),c.reserveToggle=Object(r.a)(Object(a.a)().mark((function e(){var t,n,r=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=r.length>0&&void 0!==r[0]?r[0]:{}).id){e.next=16;break}if(c.setState({detailPending:!0}),n=!1,!t.reserved){e.next=10;break}return e.next=7,c.context.api.q("/connector/reserve/cancel",{id:t.id});case 7:n=e.sent,e.next=13;break;case 10:return e.next=12,c.context.api.q("/connector/reserve/now",{id:t.id});case 12:n=e.sent;case 13:c.setState({detailPending:!1}),!1===n?I.b.error(c.m("method.fail","")):I.b.success(c.m("method.success","")),c.load();case 16:case"end":return e.stop()}}),e)}))),c.state={detailPending:!1,pending:!1,stationId:!1,item:{},access:{},files:[]},c}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.load()}},{key:"componentDidUpdate",value:function(e){var t=this;e.stationId===this.props.stationId&&e.intl.locale===this.props.intl.locale||this.setState({item:{}},(function(){return t.load()}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.pending,a=t.item,r=t.access,i=t.files,c=a.connectors||[],s=function(t){var n=t.item,a=t.property,r=null===n||void 0===n?void 0:n[a];return r?(Object(T.a)(r)&&(r=new Date(r).toLocaleString()),Object(F.jsxs)(C.a,{gutter:[16,16],className:"gx-mb-2",children:[Object(F.jsx)(P.a,{className:"gx-text-muted gx-font-weight-light gx-pr-2",xs:10,children:e.m(a)}),Object(F.jsx)(P.a,{xs:14,children:r})]})):null};return Object(F.jsx)("div",{children:Object(F.jsxs)(N.a,{spinning:n,children:[!(null!==a&&void 0!==a&&a.id)&&Object(F.jsx)(d.a,{}),(null===a||void 0===a?void 0:a.id)&&Object(F.jsxs)("div",{className:"gx-mb-3",children:[(null===a||void 0===a?void 0:a.description)&&Object(F.jsx)("div",{className:"gx-text-muted gx-font-weight-light gx-mb-3",children:a.description}),Object(F.jsxs)(q.a,{between:!0,className:"gx-mb-3 gx-pr-1",children:[Object(F.jsx)("h4",{children:this.m("details")}),Object(F.jsx)(K.a,Object(w.a)(Object(w.a)({},a),{},{readOnly:!(null!==r&&void 0!==r&&r.u),onFinish:this.load}))]}),["typename","modelname","vendorname","serialnumber","boxserialnumber","iccid","imsi","networkname","connectionupdate","lastupdate"].map((function(e){return Object(F.jsx)(s,{item:a,property:e},e)})),c.length>0&&Object(F.jsx)(F.Fragment,{children:Object(F.jsxs)(N.a,{spinning:this.state.detailPending,children:[Object(F.jsx)("hr",{}),c.map((function(t,n){return Object(F.jsx)("div",{className:"gx-mb-2",children:Object(F.jsxs)(q.a,{between:!0,children:[Object(F.jsxs)("div",{children:[t.chargername,Object(F.jsx)("div",{className:"gx-font-weight-light gx-text-small gx-text-muted",children:t.chargerdescription})]}),Object(F.jsx)("div",{className:"gx-ml-2 gx-mr-1",children:Object(F.jsx)("div",{style:{whiteSpace:"nowrap"},children:Object(F.jsx)(E.a,Object(w.a)(Object(w.a)({m:e.m},t),{},{chargeToggle:function(n){return e.chargeToggle(t,n)},reserveToggle:function(n){return e.reserveToggle(t,n)}}))})})]})},n)}))]})}),(null===r||void 0===r?void 0:r.u)&&Object(F.jsx)(k.a,{to:"/crm/station/".concat(a.id),children:Object(F.jsx)(L.a,{className:"gx-mb-0 gx-mt-4",children:this.m("edit","")})}),i.length>0&&Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)("hr",{}),i.map((function(e,t){return Object(F.jsx)("img",{alt:"",src:window.appConfig.apiDomain+e.link},t)}))]})]})]})})}}]),n}(h.a.Component);A.contextType=v.a;var G=Object(b.i)(Object(g.c)(A)),V=(n(855),function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(e){var c;return Object(i.a)(this,n),(c=t.call(this,e)).pendingStart=function(){c.props.onPendingStart?c.props.onPendingStart():c.setState({pending:!0})},c.pendingEnd=function(){c.props.onPendingEnd?c.props.onPendingEnd():c.setState({pending:!1})},c.m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"stations.map.",n=c.props.intl;return n.formatMessage({id:t+e})},c.setParams=function(){var e=c.props.match.params,t=e.param1,n=e.param2;c.setState({carId:t,chargerId:n},(function(){return c.load()}))},c.load=Object(r.a)(Object(a.a)().mark((function e(){var t,n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.pendingStart(),t=[],c.state.chargerId&&t.push({field:"connectors",compare:"GIN",value:[{charger:c.state.chargerId}]}),e.next=5,c.context.api.q("/charge_point/list",{search:t},{toArray:!0});case 5:n=e.sent,c.setState({stations:n},(function(){return c.pendingEnd()}));case 7:case"end":return e.stop()}}),e)}))),c.getItemGeo=function(e){var t,n=(null===e||void 0===e||null===(t=e.geo)||void 0===t?void 0:t[0])||{},a=n.latitude,r=n.longitude;return a&&r?[a,r]:null},c.drawerClose=function(){c.setState({drawerVisible:!1})},c.onPlacemarkClick=function(e){c.setState({drawerItem:e,drawerVisible:!0})},c.config=window.appConfig||{mapLanguage:"ru_RU"},c.state={mapLoaded:!1,pending:!1,stations:[],carId:!1,chargerId:!1,drawerVisible:!1,drawerItem:{}},c}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.setParams(),this.load()}},{key:"componentDidUpdate",value:function(e){Object(O.a)(e,this.props)&&this.setParams(),e.intl.locale!==this.props.intl.locale&&this.load()}},{key:"render",value:function(){var e=this,t=this.state,n=t.stations,a=t.mapLoaded,r=t.pending,i=t.drawerItem;window.appConfig.mapDefaultCenter;if(!Array.isArray(n))return null;if(0===n.length)return Object(F.jsx)(d.a,{});var c=n.map((function(t){return e.getItemGeo(t)})).filter((function(e){return e}));if(0===c.length)return Object(F.jsx)("div",{className:this.props.className,children:Object(F.jsx)(d.a,{})});var s=h.a.createRef(),o=this.config.mapLanguage;return Object(F.jsxs)(F.Fragment,{children:[(!a||r)&&Object(F.jsx)(f.a,{}),Object(F.jsx)(l.a,{title:null===i||void 0===i?void 0:i.label,placement:"right",onClose:this.drawerClose,visible:this.state.drawerVisible,children:Object(F.jsx)(x.a,{children:Object(F.jsx)(G,{stationId:null===i||void 0===i?void 0:i.id})})}),Object(F.jsx)(m.a,{children:Object(F.jsx)("title",{children:this.m("stations")})}),Object(F.jsxs)("div",{className:"gx-st-map huge",style:{visibility:a&&!r?"visible":"hidden"},children:[Object(F.jsx)("div",{className:"filterbox",children:Object(F.jsx)(p.a,{size:"small",children:Object(F.jsx)(y.a,{value:this.state.carId,placeholder:this.m("forcar"),formatLabel:function(e){return"".concat(e.label," ").concat(e.identity)},extraFields:["identity","chargerac"],enabledOnly:!0,labelKey:"label",query:"/car/list",onChange:function(t,n){e.props.history.push("/driver/stations/".concat(t,"/").concat(n.chargerac||""))}})})}),Object(F.jsx)(j.c,{query:{lang:o},children:Object(F.jsxs)(j.a,{defaultState:{center:c[0]||[50.85045,4.34878],zoom:9},width:"100%",height:"100%",modules:["geoObject.addon.balloon","util.bounds"],onLoad:function(t){e.setState({mapLoaded:!0}),c.length>1&&s.current.setBounds(t.util.bounds.fromPoints(c))},instanceRef:function(e){e&&(s.current=e)},children:[0!==n.length?n.map((function(t,n){var a=e.getItemGeo(t);if(!a)return null;var r=[];return t.description&&r.push("<div>".concat(t.description||"","</div>")),t.modelname&&r.push("<div>".concat(t.modelname||""," ").concat(t.vendorname||"","</div>")),Object(F.jsx)(j.b,{defaultGeometry:a,onClick:function(){return e.onPlacemarkClick(t)},options:{iconLayout:"default#image",iconImageHref:"/assets/images/images-32-removebg-preview.png",iconImageSize:[32,32]}},n)})):[],Object(F.jsx)(j.d,{})]})},o)]})]})}}]),n}(h.a.Component));V.contextType=v.a;t.default=Object(b.i)(Object(g.c)(V))}}]);
//# sourceMappingURL=8.908685a2.chunk.js.map